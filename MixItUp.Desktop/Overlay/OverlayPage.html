<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
    </head>
    <body style="background-color:transparent">
        <div id="mainOverlay" />

		<script src="/socket.io/socket.io.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script>
			var mainOverlayDiv = document.getElementById('mainOverlay');
			
			var socket = io();
			
			socket.on('test', function(packet)
			{
			    var addedElement = document.createElement('h1');
                addedElement.innerHTML = 'Connection Test!';
                addedElement.style.cssText += 'font-size: 100px';

			    var data = { horizontal: 50, vertical: 50, duration: 3 };

			    addWaitRemoveElement(data, addedElement);
			});
			
			socket.on('image', function(packet)
			{
				data = getDataFromJSON(packet);
				if (data != null)
				{
					var addedElement = null;

					if (data.imagePath != null)
					{
						addedElement = document.createElement('img');

						var imageType = "data:image/png";
						if (data.imagePath.endsWith("gif")) {
						    imageType = "data:image/gif";
						}
						else if (data.imagePath.endsWith("jpg")) {
						    imageType = "data:image/jpg";
						}
						else if (data.imagePath.endsWith("jpeg")) {
						    imageType = "data:image/jpeg";
						}

						addedElement.src = imageType + ";base64," + data.imageData;

						addedElement.style.cssText += 'width: ' + data.width + 'px; height: ' + data.height + 'px; ';
						
						addWaitRemoveElement(data, addedElement);
					}
				}
			});
			
			socket.on('text', function(packet)
			{
				data = getDataFromJSON(packet);
				if (data != null)
				{
					var addedElement = null;

					if (data.text != null)
					{
						addedElement = document.createElement('h1');
						addedElement.innerHTML = data.text;
						addedElement.style.cssText += 'font-size: ' + data.fontSize + 'px; color: ' + data.color + '; ' +
						    'text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;';
					}
					
					addWaitRemoveElement(data, addedElement);
				}
            });

            socket.on('htmlText', function (packet) {
                data = getDataFromJSON(packet);
                if (data != null) {
                    var addedElement = null;

                    if (data.htmlText != null) {
                        addedElement = document.createElement('div');
                        addedElement.innerHTML = data.htmlText;
                    }

                    addWaitRemoveElement(data, addedElement);
                }
            });
			
			function getDataFromJSON(packet)
			{
				try
				{
					if (packet != null)
					{
						return JSON.parse(packet);
					}
				}
				catch (err) { console.log(err); }
				return null;
			}

			function addWaitRemoveElement(data, addedElement)
			{
				if (addedElement != null)
				{
					addedElement.style.cssText += 'position: absolute; left: ' + data.horizontal.toString() + '%; top: ' +
						data.vertical.toString() + '%; transform: translate(-50%, -50%);'

					mainOverlayDiv.appendChild(addedElement);

					setTimeout(function ()
					{
						mainOverlayDiv.removeChild(addedElement);
					}, data.duration * 1000);
				}
			}
		</script>
    </body>
</html>