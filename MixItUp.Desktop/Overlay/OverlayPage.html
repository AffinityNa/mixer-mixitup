<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
    </head>
    <body style="background-color:transparent">
        <div id="mainOverlay" />

		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script>
            var mainOverlayDiv = document.getElementById('mainOverlay');

            function openWebsocketConnection()
            {
                try
                {
                    var connection = new WebSocket("ws://localhost:8111/ws/");

                    // When the connection is open, send some data to the server
                    connection.onopen = function ()
                    {
                        var packet = { type: 'ping', data: '' };
                        connection.send(JSON.stringify(packet));
                    };

                    // Log messages from the server
                    connection.onmessage = function (e)
                    {
                        var packet = getDataFromJSON(e.data);
                        if (packet != null && packet.type != null && packet.data != null)
                        {
                            if (packet.type === "test")
                            {
                                testPacket(packet.data);
                            }
                            else if (packet.type === "image")
                            {
                                imagePacket(packet.data);
                            }
                            else if (packet.type === "text")
                            {
                                textPacket(packet.data);
                            }
                            else if (packet.type === "htmlText")
                            {
                                htmlTextPacket(packet.data);
                            }
                        }
                    };

                    // Log errors
                    connection.onerror = function (error) {
                        console.log('WebSocket Error ' + error);
                    };

                    connection.onclose = function (e) {
                        setTimeout(function () { openWebsocketConnection(); }, 2000);
                    };
                }
                catch (err) { console.log(err); }
            }

            function testPacket(data)
            {
                var addedElement = document.createElement('h1');
                addedElement.innerHTML = 'Connection Test!';
                addedElement.style.cssText += 'font-size: 100px';

                var data = { horizontal: 50, vertical: 50, duration: 3 };

                addWaitRemoveElement(data, addedElement);
            }

            function imagePacket(data)
            {
                var addedElement = null;

                if (data.imagePath != null)
                {
                    addedElement = document.createElement('img');

                    var imageType = "data:image/png";
                    if (data.imagePath.endsWith("gif"))
                    {
                        imageType = "data:image/gif";
                    }
                    else if (data.imagePath.endsWith("jpg"))
                    {
                        imageType = "data:image/jpg";
                    }
                    else if (data.imagePath.endsWith("jpeg"))
                    {
                        imageType = "data:image/jpeg";
                    }

                    addedElement.src = imageType + ";base64," + data.imageData;

                    addedElement.style.cssText += 'width: ' + data.width + 'px; height: ' + data.height + 'px; ';

                    addWaitRemoveElement(data, addedElement);
                }
            }

            function textPacket(data)
            {
                var addedElement = null;

                if (data.text != null)
                {
                    addedElement = document.createElement('h1');
                    addedElement.innerHTML = data.text;
                    addedElement.style.cssText += 'font-size: ' + data.fontSize + 'px; color: ' + data.color + '; ' +
                        'text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;';
                }

                addWaitRemoveElement(data, addedElement);
            }

            function htmlTextPacket(data)
            {
                var addedElement = null;

                if (data.htmlText != null)
                {
                    addedElement = document.createElement('div');
                    addedElement.innerHTML = data.htmlText;
                }

                addWaitRemoveElement(data, addedElement);
            }
			
			function getDataFromJSON(packet)
			{
				try
				{
					if (packet != null)
					{
						return JSON.parse(packet);
					}
				}
				catch (err) { console.log(err); }
				return null;
			}

			function addWaitRemoveElement(data, addedElement)
			{
				if (addedElement != null)
				{
					addedElement.style.cssText += 'position: absolute; left: ' + data.horizontal.toString() + '%; top: ' +
						data.vertical.toString() + '%; transform: translate(-50%, -50%);'

					mainOverlayDiv.appendChild(addedElement);

					setTimeout(function ()
					{
						mainOverlayDiv.removeChild(addedElement);
					}, data.duration * 1000);
				}
            }

            openWebsocketConnection();
		</script>
    </body>
</html>