<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <head>
        <meta charset="utf-8" />
        <title></title>
        <script language="JavaScript">
            function processResultAndRepeat(status, result)
            {
                if (status == 200)
                {
                    data = JSON.parse(result);

                    var imageElement = document.createElement('img');
                    imageElement.id = 'imageOverlay';
                    imageElement.src = "data:image/png;base64," + data.fileData;
                    imageElement.style.cssText = 'position: absolute; left: ' + data.horizontal.toString() + '%; top: ' +
                        data.vertical.toString() + '%; transform: translate(-50%, -50%);'

                    var mainOverlayDiv = document.getElementById('mainOverlay');
                    mainOverlayDiv.appendChild(imageElement);

                    setTimeout(function () {
                        mainOverlayDiv.removeChild(imageElement);
                        sendGETRequest();
                    }, data.duration * 1000);
                }
                else
                {
                    sendGETRequest();
                }
            }

            function sendGETRequest()
            {
                $.ajax({
                    url: 'http://localhost:8001/',
                    type: 'GET',
                    timeout: 2000,
                })
                .success(function (data, textStatus, jqXHR) {
                    processResultAndRepeat(jqXHR.status, data);
                })
                .error(function (jqXHR, textStatus) {
                    processResultAndRepeat(-1, '');
                });
            }

            function sleep(milliseconds)
            {
                return new Promise(resolve => setTimeout(resolve, milliseconds));
            }

            sendGETRequest();
        </script>
    </head>
    <body style="background-color:transparent">
        <div id="mainOverlay" />
    </body>
</html>